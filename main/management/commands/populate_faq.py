from django.core.management.base import BaseCommand
from main.models import FAQ, FAQCategory

class Command(BaseCommand):
    help = 'Заполняет базу данных тестовыми данными FAQ'

    def handle(self, *args, **options):
        self.stdout.write('Создание категорий FAQ...')
        
        # Создаем категории
        categories_data = [
            {'name': 'Административные процессы', 'description': 'Вопросы по административным процедурам', 'order_index': 1},
            {'name': 'IT поддержка', 'description': 'Технические вопросы и поддержка', 'order_index': 2},
            {'name': 'Кампус и инфраструктура', 'description': 'Вопросы о кампусе и инфраструктуре', 'order_index': 3},
            {'name': 'Внутренние документы', 'description': 'Вопросы по внутренним документам', 'order_index': 4},
        ]
        
        categories = {}
        for cat_data in categories_data:
            category, created = FAQCategory.objects.get_or_create(
                name=cat_data['name'],
                defaults={
                    'description': cat_data['description'],
                    'order_index': cat_data['order_index'],
                    'is_active': True
                }
            )
            categories[cat_data['name']] = category
            if created:
                self.stdout.write(f'✓ Создана категория: {category.name}')
            else:
                self.stdout.write(f'→ Категория уже существует: {category.name}')
        
        self.stdout.write('\nСоздание FAQ...')
        
        # Создаем FAQ
        faq_data = [
            {
                'question': 'Как восстановить пароль от корпоративной почты?',
                'answer': 'Для восстановления пароля от корпоративной почты:\n\n1. Обратитесь в IT отдел по телефону +7 (727) 302-65-65\n2. Предоставьте свои ФИО и табельный номер\n3. IT специалист выдаст вам временный пароль\n4. При первом входе система попросит сменить пароль на постоянный\n\nПароль должен содержать минимум 8 символов, включая заглавные и строчные буквы, цифры.',
                'category': 'IT поддержка',
                'is_popular': True,
                'order_index': 1
            },
            {
                'question': 'Как получить доступ к внутренним системам (LMS, CRM и др.)?',
                'answer': 'Для получения доступа к внутренним системам:\n\n1. Подайте заявку через систему ServiceDesk или обратитесь к непосредственному руководителю\n2. В заявке укажите:\n   - К каким системам нужен доступ\n   - Обоснование необходимости доступа\n   - Срок действия доступа\n3. После согласования с руководителем, IT отдел создаст учетные записи\n4. Логины и пароли будут высланы на корпоративную почту\n\nОбычно процесс занимает 1-2 рабочих дня.',
                'category': 'IT поддержка',
                'is_popular': True,
                'order_index': 2
            },
            {
                'question': 'Где найти устав и регламенты AlmaUni?',
                'answer': 'Устав и регламенты AlmaUni доступны в следующих местах:\n\n1. **Внутренний портал**: раздел "Документы" → "Нормативные документы"\n2. **Папка на сетевом диске**: \\\\server\\docs\\regulations\n3. **У секретаря деканата**: бумажные версии основных документов\n4. **Официальный сайт университета**: публичные документы в разделе "О университете"\n\nОсновные документы:\n- Устав университета\n- Положение о структурных подразделениях\n- Регламент документооборота\n- Кодекс этики сотрудников',
                'category': 'Внутренние документы',
                'is_popular': False,
                'order_index': 1
            },
            {
                'question': 'Как подать заявку на ремонт в кабинете?',
                'answer': 'Для подачи заявки на ремонт:\n\n1. **Через систему заявок**:\n   - Зайдите в внутренний портал\n   - Выберите "Хозяйственные заявки"\n   - Заполните форму с описанием проблемы\n\n2. **По телефону**: +7 (727) 302-65-70 (хозяйственная служба)\n\n3. **Лично**: кабинет 101, хозяйственный отдел\n\nВ заявке обязательно укажите:\n- Номер кабинета\n- Описание неисправности\n- Степень срочности\n- Контактные данные\n\nСрочные заявки (отопление, водопровод, электричество) рассматриваются в течение 4 часов.',
                'category': 'Кампус и инфраструктура',
                'is_popular': False,
                'order_index': 1
            },
            {
                'question': 'Как оформить командировку?',
                'answer': 'Процедура оформления командировки:\n\n1. **За 10 дней до поездки**:\n   - Подайте служебную записку руководителю\n   - Получите согласование на командировку\n\n2. **За 5 дней**:\n   - Подайте заявление в отдел кадров\n   - Приложите документы: программа мероприятия, приглашение\n\n3. **Оформление приказа**:\n   - Отдел кадров готовит приказ о командировке\n   - Получите командировочное удостоверение\n\n4. **Получение аванса** (при необходимости):\n   - Подайте заявление в бухгалтерию\n   - Укажите сумму и назначение расходов\n\n5. **После возвращения** (в течение 3 дней):\n   - Сдайте отчет о командировке\n   - Предоставьте документы об израсходованных средствах',
                'category': 'Административные процессы',
                'is_popular': True,
                'order_index': 1
            },
            {
                'question': 'Где находится медпункт и какие услуги он предоставляет?',
                'answer': 'Медицинский пункт AlmaUni:\n\n**Расположение**: 1 этаж, кабинет 115\n**Время работы**: Пн-Пт с 9:00 до 18:00, обед с 13:00 до 14:00\n\n**Услуги**:\n- Первая медицинская помощь\n- Измерение давления, температуры\n- Медицинские справки для больничного\n- Консультации медсестры\n- Аптечка первой помощи\n\n**Контакты**:\n- Телефон: внутренний 115\n- Медсестра: Айгуль Сериковна\n\n**В экстренных случаях**:\n- Вызов скорой помощи: 103\n- Служба безопасности: внутренний 101',
                'category': 'Кампус и инфраструктура',
                'is_popular': False,
                'order_index': 2
            },
            {
                'question': 'Как получить справку о работе?',
                'answer': 'Для получения справки о работе:\n\n1. **Подача заявления**:\n   - Напишите заявление на имя начальника отдела кадров\n   - Укажите цель получения справки\n   - Подайте заявление лично или через секретаря\n\n2. **Необходимые документы**:\n   - Паспорт (для сверки данных)\n   - Заявление в произвольной форме\n\n3. **Сроки изготовления**:\n   - Обычная справка: 1-2 рабочих дня\n   - Справка с переводом: 3-5 рабочих дней\n   - Срочная справка: в день обращения (доплата 50%)\n\n4. **Получение**:\n   - Лично в отделе кадров (каб. 205)\n   - Время работы: Пн-Пт с 9:00 до 18:00\n\n**Виды справок**: о работе, о зарплате, о стаже, характеристика',
                'category': 'Административные процессы',
                'is_popular': False,
                'order_index': 2
            }
        ]
        
        for faq_item in faq_data:
            category = categories[faq_item['category']]
            faq, created = FAQ.objects.get_or_create(
                question=faq_item['question'],
                defaults={
                    'answer': faq_item['answer'],
                    'category': category,
                    'is_popular': faq_item['is_popular'],
                    'order_index': faq_item['order_index'],
                    'is_active': True,
                    'views_count': 0
                }
            )
            if created:
                self.stdout.write(f'✓ Создан FAQ: {faq.question[:50]}...')
            else:
                self.stdout.write(f'→ FAQ уже существует: {faq.question[:50]}...')
        
        self.stdout.write(
            self.style.SUCCESS(
                f'\nУспешно! Создано {FAQCategory.objects.count()} категорий и {FAQ.objects.count()} вопросов.'
            )
        )